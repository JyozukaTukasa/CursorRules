---
description: "Trigger: @refactor - 安全なリファクタリング（機能変更なし）"
globs: []
alwaysApply: false
---

# 安全なリファクタリング (Safe Refactoring)

**Current Phase: Execution**
適用ルール: `002-coding.mdc`

## 1. 事前テスト (Baseline Check)
「壊れたコードをリファクタリングしてはいけません。」
まず既存テストを実行し、全てパスすることを確認する。

```bash
npm test
```
失敗したら即終了。

## 2. リファクタリング実行
指定されたスコープ（関数、クラス、ファイル）に対して、**機能・振る舞いを変えずに** 内部構造のみを改善する。

改善対象：
- 変数名の明確化
- 関数の抽出・共通化
- 複雑な条件分岐の整理

**⚠️ 厳禁**: アルゴリズムの変更や新機能追加

## 3. 事後テスト (Regression Check)
再度テストを実行し、振る舞いが変わっていないことを保証する。

```bash
npm test
```

## 4. 自動ロールバック
もし事後テストが失敗した場合、直前の変更を破棄して元の状態に戻すことを提案・実行する。

```bash
git checkout .
```
（※ユーザー承認後に実行）
