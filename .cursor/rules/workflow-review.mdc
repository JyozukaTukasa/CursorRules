---
description: "Trigger: @review - コードレビュー（自動修正付き）"
globs: []
alwaysApply: false
---

# レビューフェーズ (Auto-Fix & Smart Diff)

// turbo

**Current Phase: Execution**
適用ルール: `002-coding.mdc`

## 1. レビュー対象の自動検出 (Smart Scope)
以下の優先順位で、レビュー対象の「差分」を特定する。

- **優先度1: コミット前 (Staged)**
  `git diff --staged --name-only`
  (※ 今まさにコミットしようとしている内容)

- **優先度2: 未マージのブランチ (Feature Branch)**
  `git diff main...HEAD --name-only`
  (※ PUSHしたかどうかに関わらず、mainとの差分があれば全てレビュー対象)

- **優先度3: 直近のコミット (Last Commit)**
  上記のいずれも差分がない場合、直近1回のコミットを対象とする。
  `git diff HEAD^...HEAD --name-only`

## 2. レビュー & 即時修正 (Speed)
特定された差分ファイルに対し、以下の項目は **レポートを書く前に勝手に修正** する。
- タイポ / 未使用変数 / 命名規則違反 / 明らかなインデント崩れ

## 3. セキュリティ & ロジックレビュー
- **Mitigation Check**: タスク定義時 (`current_task.md`) に挙げた「防御策」がコードに正しく実装されているか？
- 自動修正できない「ロジックのバグ」「設計レベルの不備」についてレポートを出力する。

## 4. 完了報告
「対象範囲: [Staged / Branch / LastCommit]」
「軽微な修正は適用済みです。重要な指摘事項を確認してください。」
