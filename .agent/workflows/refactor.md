---
description: リファクタリングを行う（機能変更なし・安全性最優先）
---

# 安全なリファクタリング (Safe Refactoring)

Run: `cat .agent/rules/core.md .agent/rules/coding.md`
(Current Phase: Execution)

1. **テストの存在確認 (Safety check)**

// turbo
1. **事前テスト (Baseline Check)**
   「壊れたコードをリファクタリングしてはいけません。」
   まず既存テストを実行し、全てパスすることを確認する。
   Run: `npm test` (失敗したら即終了)

2. **リファクタリング実行**
   指定されたスコープ（関数、クラス、ファイル）に対して、**機能・振る舞いを変えずに** 内部構造のみを改善する。
   - 変数名の明確化
   - 関数の抽出・共通化
   - 複雑な条件分岐の整理
   ※ アルゴリズムの変更や新機能追加は **厳禁**。

3. **事後テスト (Regression Check)**
   再度テストを実行し、振る舞いが変わっていないことを保証する。
   Run: `npm test`

4. **自動ロールバック**
   もし事後テストが失敗した場合、直前の変更を破棄して元の状態に戻すことを提案・実行する。
   Run: `git checkout .` (※ユーザー承認後に実行)
